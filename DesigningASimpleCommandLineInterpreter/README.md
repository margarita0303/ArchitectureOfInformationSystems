# Проектирование простого интерпретатора командной строки

## Архитектура процесса работы 

![изображение](https://user-images.githubusercontent.com/44027333/189878373-fe840eb4-5ba0-4fa1-ad83-762a190ad866.png)

### Архитектурные части

1. UserInterface (input: string, output: string) - интерфейс взаимодействия с пользователем, который предлагает ввести команду, а затем выводит результат.
3. Lexer (input: string, output: [string]) - принимает на вход команду пользователя и разбивает ее на токены. 
4. Substitutor (input: [string], output: string) - принимает на вход список токенов, выполняет подстановку переменных, если она есть, формирует заново строку с пробелами между токенами.
5. Parser (input: [string], output: [CmdType], [[string]]) - принимает на вход список токенов и выдает список типов команд и список параметров команд. 
6. CmdFactory (input: CmdType, [string], output: Cmd) - принимает на вход тип команды и список параметров и выдает команду. При ситуации, когда 
введено что-то, что интерпретатор не знает, генерирует команду вызова внешней программы (при ее наличии). 
8. Interpretator (input: [Cmd], output: string) - принимает на вход список команд, созданных CmdFactory, и выдает на вход результат примененных команд. 

### Процесс 

1. Пользователь запускает интерпретатор, создается экземпляр InterpreterSession, в котором будет происходить весь процесс.
2. Открывается UserInterface, предлагающий пользователю ввести строку (команду) с клавиатуры.
3. Пользователь вводит строку, нажимает Enter.
4. Введенная строка передается в Lexer, который разбивает строку на токены (разбиение на токены происходит по пробелам и знакам "=", разбиение не происходит внутри кавычек) и передает список токенов в Substitutor.
5. Substitutor выполняет подстановку переменных в токенах (поиск знака "$" (в строках, которые находятся в двойных кавычках и в просто строках), а затем проверка наличия переменной, которая идет следом за "$"), формирует заново строку (соединяет токены, вставляя между ними пробелы, а в случае с "=" склеивает с соседними токенами) и передает ее обратно в Lexer.
6. Lexer разбивает строку на токены.
7. Список токенов, созданных Lexer, передается в Parser.
8. Parser разделяет список токенов на команды, ориентируясь на разделяющий токен "|", формирует 2 списка: список типов команд и список параметров команд, 
каждый тип команды с ее параметрами.
9. Запускается цикл, который по каждому типу команды и ее параметрам обращается к CmdFactory, чтобы получить команду Cmd.
10. CmdFactory по типу команды и параметрам создает команду (структура Cmd).
11. Cписок команд передается в Interpretator.
12. Interpretator последовательно выполняет команды с помощью метода cmdExecute, который в свою очередь вызывает Cmd.execute, принимающий на вход текущие значения переменных и результат предыдущей команды
13. Interpretator формирует результирующую строку и передает ее в UserInterface.
14. UserInterface выводит результат на экран.
15. UserInterface предлагает пользователю ввести строку (команду) с клавиатуры.

### Ошибки
Ошибки могут возвращать:
1. Lexer: ошибка в введенной строке (незакрытые кавычки).
3. Substitutor: ошибка, если переменная не существует.
4. CmdFactory: ошибка, если не удалось найти файл с вызовом внешней программы при обнаружении неизвестного типа команды.
5. Interpretator: команда выхода из интерпретатора; ошибка выполнения команды (неправильное число параметров, некорректные параметры).

Ошибки отлавливаются с помощью блоков try / catch.

## Структуры и зависимости 

![изображение](https://user-images.githubusercontent.com/44027333/189904257-fc821946-10a4-4eb8-842d-2c2107a59311.png)

### Структуры

1. UserInterface - структура, задача которой - отрисовка на экране приглашения к вводу строки с клавиатуры и вывода результата
2. Lexer - структура, содержащая метод lex(string) -> [string] (разбиение строки на список токенов)
3. Substitutor - структура, содержащая метод substr([string]) -> string (подстановка переменных в токенах, а затем формирование строки)
4. Parser - структура, содержащая метод parse([string]) -> [CmdType], [[string]] (формирование 2 списков: список типов команд и список параметров команд по списку токенов)
5. CmdType - enum, содержащий типы cat, echo, wc, pwd, ex, unknown, assign 
6. CmdFactory - структура, содержащая метод createCmd(CmdType, [string]) -> Cmd (создание экземпляра Cmd по типу команды и параметрам)
7. Cmd (команда) - структура, содержащая параметры args : [string], nArgs : int, а также метод execute(Context, string) -> string (исполнение команды по текущим значениям переменных и входным данным)
8. Interpretator - структура, содержащая метод executeCmd(Cmd) -> string (исполнение команды)
10. InterpreterSession - основной процесс, содержит экземпляры UserInterface, Lexer, Substitutor, Parser, CmdFactory, Interpretator и управляет процессами взаимодействия между ними, а также переменные, создаваемые пользователем с помощью команд.

### Зависимости

1. InterpreterSession имеет зависимость от UserInterface, Lexer, Substitutor, Parser, CmdFactory, Interpretator
2. Substitutor имеет зависимость от InterpreterSession
3. Interpretator имеет зависимость от InterpreterSession, Cmd
4. CmdFactory имеет зависимость от Cmd, CmdType

